(()=>{"use strict";const e=e=>fetch(e).then((e=>{if(e.ok)return e.json();throw new Error(`${e.status} ${e.statusText}`)})).catch((e=>{throw e})),t=(e,t)=>fetch(e,{method:t.method,headers:{"Content-Type":"application/json"},body:t.body?JSON.stringify(t.body):""}).then((e=>{if(e.ok)return e.json();throw new Error(`${e.status} ${e.statusText}`)})).catch((e=>{throw e})),n=async()=>{let t;return t=(e=>{let t=document.cookie.match(new RegExp("(?:^|; )"+"user".replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1")+"=([^;]*)"));return t?decodeURIComponent(t[1]):void 0})(),!!t&&(t=JSON.parse(t),e(`http://localhost:4545/users?login=${t.login}&password=${t.password}`).then((e=>{if(0!==e.length)return!0})))};const s=e=>{const t=document.getElementById("tbody");t.innerHTML="",e.forEach((e=>{t.insertAdjacentHTML("beforeend",`\n        <tr class="table__row">\n            <td class="table__id table__cell">${e.id}</td>\n            <td class="table-type table__cell">${e.type}</td>\n            <td class="table-name table__cell">\n                ${e.name}\n            </td>\n            <td class="table-units table__cell">\n                ${e.units}\n            </td>\n            <td class="table-cost table__cell">\n                ${e.cost} руб\n            </td>\n            <td>\n                <div class="table__actions table__cell">\n                    <button class="button action-change"><span class="svg_ui"><svg class="action-icon_change"><use xlink:href="./img/sprite.svg#change"></use></svg></span><span>Изменить</span>\n                    </button>\n                    <button class="button action-remove"><span class="svg_ui"><svg class="action-icon_remove"><use xlink:href="./img/sprite.svg#remove"></use></svg></span><span>Удалить</span>\n                    </button>\n                </div>\n            </td>\n        </tr>\n        `)}))};"index.html"===/\w*\.html/.exec(document.location.href)[0]?(n().then((e=>{e&&window.location.replace("table.html")})).catch((e=>console.log(e.message))),(()=>{const t=document.querySelector(".main-auth form"),n=t.querySelectorAll(".text-warning"),s=t.querySelector("input[type=text]"),l=t.querySelector("input[type=password]"),o=()=>{n.forEach((e=>{e.style.display="none"}))};t.addEventListener("submit",(t=>{t.preventDefault(),o(),e(`http://localhost:4545/users?login=${s.value}`).then((t=>{0===t.length?n[1].style.display="":e(`http://localhost:4545/users?login=${s.value}&password=${l.value}`).then((e=>{0===e.length?n[2].style.display="":(document.cookie="user="+JSON.stringify(e[0])+";maxAge=864000",window.location.replace("table.html"))})).catch((e=>{throw e}))})).then((e=>{s.value="",l.value=""})).catch((e=>{console.log(e.message),n[0].style.display=""}))})),o()})()):"table.html"===/\w*\.html/.exec(document.location.href)[0]&&(n().then((e=>{e||window.location.replace("index.html")})).catch((e=>{console.log(e.message),window.location.replace("index.html")})),window.itemService=new class{constructor(e){this._url=e}getItems(){return e(this._url)}addItem(e){return t(this._url,{method:"POST",body:e})}removeItem(e){return t(`${this._url}/${e}`,{method:"DELETE"})}getItem(t){return e(`${this._url}/${t}`)}getItemBy(t,n){return e(`${this._url}?${t}=${n}`)}editItem(e,n){return t(`${this._url}/${e}`,{method:"PUT",body:n})}}("http://localhost:4545/prices"),itemService.getItems().then((e=>{s(e)})).catch((e=>console.log(e.message))),(()=>{const e=document.getElementById("typeItem");e.addEventListener("input",(()=>{"Все услуги"===e.value.trim()?itemService.getItems().then((e=>{s(e)})).catch((e=>console.log(e.message))):itemService.getItemBy("type",e.value.trim()).then((e=>{s(e)})).catch((e=>console.log(e.message)))})),itemService.getItems().then((t=>{let n=[];e.innerHTML='<option value="Все услуги">Все услуги</option>',t.forEach((t=>{n.includes(t.type)||(n.push(t.type),e.insertAdjacentHTML("beforeend",`<option value="${t.type}">${t.type}</option>`))}))})).catch((e=>console.log(e.message)))})(),(()=>{const e=document.querySelector(".btn-addItem"),t=document.getElementById("modal"),n=t.querySelector("form"),l=n.querySelector("#type"),o=n.querySelector("#name"),a=n.querySelector("#units"),c=n.querySelector("#cost");e.addEventListener("click",(()=>{t.style.display="flex"})),t.addEventListener("click",(e=>{e.target.closest(".cancel-button")?(e.preventDefault(),t.style.display="",n.reset()):e.target.closest(".button__close")&&(t.style.display="")})),n.addEventListener("submit",(e=>{if(e.preventDefault(),!n.dataset.item){const e={type:l.value,name:o.value,units:a.value,cost:c.value};itemService.addItem(e).then((()=>{itemService.getItems().then((e=>{s(e),n.reset(),t.style.display=""}))}))}}))})(),(()=>{const e=document.getElementById("tbody"),t=document.getElementById("modal"),n=t.querySelector("form"),l=n.querySelector("#type"),o=n.querySelector("#name"),a=n.querySelector("#units"),c=n.querySelector("#cost");e.addEventListener("click",(e=>{if(e.target.closest(".action-change")){e.preventDefault(),t.style.display="flex";const s=e.target.closest("tr").querySelector(".table__id").textContent;itemService.getItem(s).then((e=>{l.value=e.type,o.value=e.name,a.value=e.units,c.value=e.cost,n.dataset.item=s}))}})),n.addEventListener("submit",(e=>{if(e.preventDefault(),n.dataset.item){const e=n.dataset.item,r={type:l.value,name:o.value,units:a.value,cost:c.value};itemService.editItem(e,r).then((()=>{itemService.getItems().then((e=>{s(e),n.reset(),n.removeAttribute("data-item"),t.style.display=""}))}))}}))})(),document.getElementById("tbody").addEventListener("click",(e=>{if(e.target.closest(".action-remove")){e.preventDefault();const t=e.target.closest("tr").querySelector(".table__id").textContent;itemService.removeItem(t).then((()=>{itemService.getItems().then((e=>{s(e)}))}))}})))})();